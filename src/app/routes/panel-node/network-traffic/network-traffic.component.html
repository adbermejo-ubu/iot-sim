@if (node().connected) {
    @if (node().traffic.length > 0) {
        <div
            hlmTableContainer
            class="block max-h-64 min-h-44 overflow-auto rounded-md border border-border">
            <table hlmTable>
                <thead
                    hlmTHead
                    class="sticky top-0 bg-card shadow-[0_0_0_0.5px_hsl(var(--border))]">
                    <tr hlmTr>
                        <th hlmTh class="w-12 font-semibold"></th>
                        <th hlmTh class="w-28 font-semibold">
                            {{ "SOURCE" | translate }}
                        </th>
                        <th hlmTh class="w-28 font-semibold">
                            {{ "DESTINATION" | translate }}
                        </th>
                        <th hlmTh class="w-[86px] font-semibold">
                            {{ "BYTES" | translate }}
                        </th>
                        <th hlmTh class="w-56 font-semibold">
                            {{ "DATA" | translate }}
                        </th>
                    </tr>
                </thead>
                <tbody hlmTBody>
                    @for (
                        item of node().traffic.slice(-50);
                        track item.timestamp
                    ) {
                        <tr hlmTr (click)="viewPacket(item)">
                            <td hlmTd class="text-center align-middle">
                                @switch (node().ip) {
                                    @case (item.srcIP) {
                                        <ng-icon
                                            name="lucideReply"
                                            size="1rem"
                                            class="text-red-600 dark:text-red-400" />
                                    }
                                    @case (item.dstIP) {
                                        <ng-icon
                                            name="lucideForward"
                                            size="1rem"
                                            class="text-green-600 dark:text-green-400" />
                                    }
                                    @default {
                                        <ng-icon
                                            name="lucideRepeat"
                                            size="1rem"
                                            class="text-yellow-600 dark:text-yellow-400" />
                                    }
                                }
                            </td>
                            <td hlmTd>{{ item.srcIP }}</td>
                            <td hlmTd>{{ item.dstIP }}</td>
                            <td hlmTd>{{ item.totalBytes }}</td>
                            <td hlmTd>{{ item.payload }}</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    } @else {
        <ng-icon
            name="lucideTrafficCone"
            size="6rem"
            class="mb-8 mt-4 self-center text-secondary" />
        <p
            class="mb-4 w-96 self-center text-center text-sm text-muted-foreground">
            {{ "NO_TRAFFIC" | translate }}
        </p>
    }
    <div class="flex w-[584px] flex-row items-center justify-end gap-2">
        <label hlmLabel class="w-40 flex-col items-start justify-start">
            {{ "COMMAND" | translate }}
            <brn-select
                [(ngModel)]="command"
                [placeholder]="'SELECT_COMMAND' | translate"
                class="mt-2! inline-block w-full">
                <hlm-select-trigger class="w-full">
                    <hlm-select-value class="block" />
                </hlm-select-trigger>
                <hlm-select-content>
                    @for (item of commands; track $index) {
                        @if (item === "---") {
                            <hlm-menu-separator />
                        } @else {
                            <hlm-option [value]="item">{{
                                item.name
                            }}</hlm-option>
                        }
                    } @empty {
                        <hlm-option disabled class="px-2">
                            {{ "NO_COMMANDS" | translate }}
                        </hlm-option>
                    }
                </hlm-select-content>
            </brn-select>
        </label>
        <label hlmLabel class="grow flex-col items-start justify-start">
            {{ (multipleTargets() ? "TARGETS" : "TARGET") | translate }}
            <brn-select
                [(ngModel)]="target"
                [placeholder]="
                    (multipleTargets() ? 'TARGETS_IP' : 'TARGET_IP') | translate
                "
                [multiple]="multipleTargets()"
                class="mt-2! inline-block w-full">
                <hlm-select-trigger class="w-full">
                    <hlm-select-value class="block" />
                </hlm-select-trigger>
                <hlm-select-content>
                    @for (item of connectedNodes; track $index) {
                        <hlm-option [value]="item.ip">{{ item.ip }}</hlm-option>
                    }
                </hlm-select-content>
            </brn-select>
        </label>
        <button
            hlmBtn
            [disabled]="!(command() && target())"
            (click)="execute()"
            class="self-end">
            {{ "LAUNCH_COMMAND" | translate }}
        </button>
    </div>
} @else {
    @if (NodeType.RouterTypes.includes(this.node().type)) {
        <ng-icon
            name="lucideHourglass"
            size="6rem"
            class="mb-8 mt-4 self-center text-secondary" />
        <p class="w-96 self-center text-center text-sm text-muted-foreground">
            {{ "NO_CONNECTED_DEVICES" | translate }}
        </p>
    } @else {
        <ng-icon
            name="lucideUnplug"
            size="6rem"
            class="mb-8 mt-4 self-center text-secondary" />
        <p class="w-96 self-center text-center text-sm text-muted-foreground">
            {{ "NO_ROUTER" | translate }}
        </p>
        <button hlmBtn (click)="connect()" [disabled]="!canConnect">
            {{ "CONNECT" | translate }}
        </button>
    }
}
